<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive guide to musical intervals and diatonic and harmonic modes for music education, with circle of fifths and modulations.">
    <meta name="keywords" content="musical intervals, musical modes, scales, music theory, music education, Ionian, Dorian, Lydian, Mixolydian, Aeolian, Phrygian, Locrian, Harmonic Minor, circle of fifths, modulations">
    <meta property="og:title" content="Musical Intervals (Modes)">
    <meta property="og:description" content="Explore musical modes with an interactive graph, detailed explanations, and the circle of fifths for modulations.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/musical-intervals">
    <title>Musical Intervals (Modes)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #f8f9f0;
            --bg-secondary: #e8ebe3;
            --text-primary: #333;
            --accent: #f59e0b;
            --accent-hover: #d97706;
            --shadow: rgba(0, 0, 0, 0.15);
            --border: rgba(0, 0, 0, 0.1);
        }
        body.dark {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --text-primary: #f9fafb;
            --accent: #fbbf24;
            --accent-hover: #d97706;
            --shadow: rgba(0, 0, 0, 0.3);
            --border: rgba(255, 255, 255, 0.1);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            overflow-y: auto;
            min-height: 100vh;
            margin: 0;
            padding-top: 80px;
            transition: background 0.3s, color 0.3s;
        }
        .section-title {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: clamp(2.5rem, 5vw, 4rem);
            line-height: 1.1;
        }
        .hero-title {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            font-size: clamp(2.5rem, 6vw, 5rem);
            line-height: 0.9;
            letter-spacing: -0.02em;
        }
        .subtitle {
            font-family: 'Inter', sans-serif;
            font-weight: 300;
            font-size: clamp(1rem, 2vw, 1.5rem);
            letter-spacing: 0.02em;
        }
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .wave-pattern {
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4d8cc' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
        }
        .content-mask {
            background: linear-gradient(45deg, rgba(248,249,240,0.95) 0%, rgba(232,235,227,0.95) 100%);
            backdrop-filter: blur(10px);
        }
        body.dark .content-mask {
            background: linear-gradient(45deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.95) 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px var(--shadow);
        }
        body.dark .card {
            background: rgba(31, 41, 55, 0.8);
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        body.dark .card::before {
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.4), transparent);
        }
        .card:hover::before {
            left: 100%;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px var(--shadow);
        }
        .section-separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
            margin: 2rem 0;
        }
        .nav-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem;
            box-shadow: 0 2px 10px var(--shadow);
            transition: background 0.3s;
        }
        body.dark .nav-menu {
            background: rgba(31,41,55,0.95);
        }
        .nav-menu ul {
            list-style: none;
            display: flex;
            justify-content: center;
            margin: 0;
            padding: 0;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .nav-menu a {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-menu a:hover {
            color: var(--accent);
        }
        html {
            scroll-behavior: smooth;
        }
        canvas {
            max-width: 95vw;
            width: 1000px;
            height: 500px;
            margin: 2rem auto;
            display: block;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 15px var(--shadow);
            transition: background 0.3s;
        }
        body.dark canvas {
            background: #374151;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 15px var(--shadow);
            transition: background 0.3s;
        }
        body.dark .modal-content {
            background: #1f2937;
            color: #f9fafb;
        }
        .modal-close {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
        }
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 5px rgba(245, 158, 11, 0.5);
        }
        .btn-go-to-chart {
            background: var(--accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.3s;
        }
        .btn-go-to-chart:hover {
            background: var(--accent-hover);
        }
        .faq-question {
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .faq-answer {
            display: none;
            margin-bottom: 2rem;
        }
        .chord-maj {
            font-weight: bold;
        }
        .chord-min {
            color: gray;
        }
        .chord-table, .interval-table { overflow-x: auto; margin: 2rem 0; }
        .chord-table table, .interval-table table { width: 100%; border-collapse: collapse; }
        .chord-table th, .chord-table td, .interval-table th, .interval-table td { border: 1px solid var(--border); padding: 0.5rem; text-align: center; }
        .chord-table th, .interval-table th { background-color: rgba(0, 0, 0, 0.05); }
        body.dark .chord-table th, body.dark .interval-table th { background-color: rgba(255, 255, 255, 0.05); }
        tr.highlight { background-color: rgba(245, 158, 11, 0.2); }
        .mode-details {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            box-shadow: 0 4px 6px var(--shadow);
        }
        body.dark .mode-details {
            background: rgba(31, 41, 55, 0.8);
        }
    </style>
</head>
<body>
    <!-- Fixed Navigation Menu -->
    <nav class="nav-menu">
        <ul>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#interval-chart">Interval Chart</a></li>
            <li><a href="#circle-of-fifths">Circle of Fifths</a></li>
            <li><a href="#chord-grid">Chord Progression Grid</a></li>
            <li><a href="#faq">FAQ</a></li>
            <li><button id="themeToggle" class="bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 px-4 py-2 rounded-lg" onclick="toggleTheme()">Dark Mode</button></li>
        </ul>
    </nav>

    <div class="max-w-7xl mx-auto p-6 pb-12">
        <!-- Section 1: Introduction -->
        <section id="introduction" class="text-center mb-12 wave-pattern">
            <div class="content-mask rounded-3xl p-8 max-w-6xl mx-8 shadow-2xl border border-gray-200/20 relative">
                <div class="absolute inset-0 overflow-hidden">
                    <div class="floating-element absolute top-10 left-10 w-24 h-24 bg-gradient-to-br from-gray-200/30 to-gray-300/30 rounded-full"></div>
                    <div class="floating-element absolute bottom-16 right-16 w-16 h-16 bg-gradient-to-br from-gray-300/30 to-gray-400/30 rounded-full" style="animation-delay: -2s;"></div>
                    <div class="floating-element absolute top-1/2 right-10 w-12 h-12 bg-gradient-to-br from-gray-200/30 to-gray-300/30 rounded-full" style="animation-delay: -4s;"></div>
                </div>
                <div class="relative z-10 space-y-4">
                    <div class="flex justify-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br from-gray-600 to-gray-800 rounded-2xl flex items-center justify-center shadow-xl">
                            <i class="fas fa-music text-white text-3xl" aria-label="Music icon"></i>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <h1 class="hero-title text-gray-800 dark:text-gray-200 leading-none">
                            Musical
                            <span class="block text-gray-600 dark:text-gray-400">Intervals</span>
                        </h1>
                        <p class="subtitle text-gray-600 dark:text-gray-400 max-w-4xl mx-auto leading-relaxed">
                            Guide to Musical Modes
                        </p>
                    </div>
                    <div class="flex flex-col items-center space-y-4 mt-8">
                        <a href="#interval-chart" class="btn-go-to-chart">Go to Chart</a>
                        <div class="bg-gray-800/10 rounded-2xl px-6 py-3">
                            <p class="text-gray-700 dark:text-gray-300 text-center">
                                <span class="font-semibold">© MMS KnockYouOut 2025</span><br>
                                <span class="text-sm text-gray-600 dark:text-gray-400">All Rights Reserved</span>
                            </p>
                        </div>
                        <div class="p-4 bg-amber-50/80 dark:bg-amber-900/80 rounded-2xl border border-amber-200/30 max-w-xl">
                            <p class="text-amber-800 dark:text-amber-200 text-center leading-relaxed">
                                <i class="fas fa-info-circle text-amber-600 dark:text-amber-400 mr-2" aria-label="Info icon"></i>
                                This guide provides information on diatonic and harmonic modes via an interactive chart and the circle of fifths for modulations.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl max-w-3xl mx-auto">
                <h2 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">Objective</h2>
                <p class="text-gray-600 dark:text-gray-400">Explore the intervals of musical modes and tonal relationships via the circle of fifths for better understanding.</p>
                <h2 class="text-lg font-semibold mt-3 mb-2 text-gray-800 dark:text-gray-200">Approach</h2>
                <p class="text-gray-600 dark:text-gray-400">Use the interactive chart to compare modes and the circle of fifths for modulations.</p>
                <h2 class="text-lg font-semibold mt-3 mb-2 text-gray-800 dark:text-gray-200">Tip</h2>
                <p class="text-gray-600 dark:text-gray-400">Select modes via the menus for detailed analysis, and click on keys in the circle to explore.</p>
            </div>
        </section>

        <div class="section-separator"></div>

        <!-- Section 2: Interval Chart -->
        <section id="interval-chart">
            <div class="text-center mb-8">
                <h1 class="section-title text-gray-800 dark:text-gray-200 mb-4">Interval Chart</h1>
                <div class="flex justify-center items-center space-x-4 text-gray-600 dark:text-gray-400">
                    <span class="bg-gray-800/10 px-4 py-2 rounded-full text-sm font-medium">Section 2 of 4</span>
                </div>
            </div>
            <div class="controls grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto mb-4">
                <select id="diatonicMode" class="p-3 border rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100" aria-label="Select a diatonic mode">
                    <option value="">Diatonic Mode</option>
                    <option value="Ionian">Ionian</option>
                    <option value="Dorian">Dorian</option>
                    <option value="Phrygian">Phrygian</option>
                    <option value="Lydian">Lydian</option>
                    <option value="Mixolydian">Mixolydian</option>
                    <option value="Aeolian">Aeolian</option>
                    <option value="Locrian">Locrian</option>
                </select>
                <select id="harmonicMode" class="p-3 border rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100" aria-label="Select a harmonic mode">
                    <option value="">Harmonic Mode</option>
                    <option value="Harmonic Minor">Harmonic Minor</option>
                    <option value="Locrian ♮6">Locrian ♮6</option>
                    <option value="Ionian ♯5">Ionian ♯5</option>
                    <option value="Dorian ♯4">Dorian ♯4</option>
                    <option value="Phrygian Dominant">Phrygian Dominant</option>
                    <option value="Lydian ♯2">Lydian ♯2</option>
                    <option value="Altered">Altered</option>
                </select>
                <button onclick="resetChart()" class="bg-blue-500 text-white p-3 rounded-lg">Reset</button>
            </div>
            <canvas id="modesChart" aria-label="Chart of musical mode intervals"></canvas>
            <!-- Interval Grid -->
            <div class="interval-table mt-4">
                <table>
                    <thead>
                        <tr>
                            <th>Mode</th>
                            <th>I-II</th>
                            <th>II-III</th>
                            <th>III-IV</th>
                            <th>IV-V</th>
                            <th>V-VI</th>
                            <th>VI-VII</th>
                            <th>VII-I</th>
                        </tr>
                    </thead>
                    <tbody id="intervalTableBody"></tbody>
                </table>
            </div>
            <!-- Mode Details Section -->
            <div id="modeDetails" class="mode-details">
                <h2 id="modeDetailTitle" class="text-xl font-semibold mb-2"></h2>
                <p><strong>Tonality:</strong> <span id="modeDetailTonality"></span></p>
                <p><strong>Notes:</strong> <span id="modeDetailNotes"></span></p>
                <p><strong>Intervals:</strong> <span id="modeDetailIntervals"></span></p>
                <p><strong>Characteristics:</strong> <span id="modeDetailCharacteristics"></span></p>
                <p><strong>Examples:</strong> <span id="modeDetailExamples"></span></p>
                <p><strong>Progression:</strong> <span id="modeDetailProgression"></span></p>
                <p><strong>Description:</strong> <span id="modeDetailDescription"></span></p>
                <p><strong>Default Tonic:</strong> <span id="modeDetailDefaultTonic"></span></p>
            </div>
            <div class="card rounded-3xl p-6 mt-6">
                <h2 class="text-xl font-semibold mb-3 text-gray-800 dark:text-gray-200">Explanation</h2>
                <p class="text-gray-600 dark:text-gray-400">The line chart shows the intervals (W=tone, H=semitone, A2=augmented second) of the visible modes. The X-axis indicates the scale degrees (I to VII). Select a mode to view its details below.</p>
            </div>
        </section>

        <div class="section-separator"></div>

        <!-- Section 3: Circle of Fifths -->
        <section id="circle-of-fifths" class="mb-12">
            <div class="text-center mb-8">
                <h1 class="section-title text-gray-800 dark:text-gray-200 mb-4">The Circle of Fifths and Modulations</h1>
                <div class="flex justify-center items-center space-x-4 text-gray-600 dark:text-gray-400">
                    <span class="bg-gray-800/10 px-4 py-2 rounded-full text-sm font-medium">Section 3 of 4</span>
                </div>
            </div>
            <div class="card rounded-3xl p-6 mb-6">
                <h2 class="text-xl font-semibold mb-3 text-gray-800 dark:text-gray-200">General Explanation</h2>
                <p class="text-gray-600 dark:text-gray-400 mb-4">The circle of fifths is a fundamental tool in music theory, used to understand relationships between keys and facilitate modulations in harmony. It represents the 12 keys of the chromatic scale, organized so that each key is separated from the next by a perfect fifth (or fourth in the other direction).</p>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Neighboring keys on the circle share many common notes, facilitating smooth harmonic transitions during modulations. For example, starting from C major, the next fifth is G major, and in the opposite direction, F major.</p>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Modulation involves shifting from one key to another. The circle of fifths guides these changes by showing tonal relationships:</p>
                <ul class="list-disc pl-5 text-gray-600 dark:text-gray-400 mb-4">
                    <li><strong>Modulations to neighboring keys:</strong> Adjacent (e.g., C → G), smooth with common pivot chords.</li>
                    <li><strong>Modulations by successive fifths:</strong> Series like C → G → D for harmonic progression.</li>
                    <li><strong>Distant modulations:</strong> Via intermediate keys or enharmonic changes.</li>
                    <li><strong>Techniques:</strong> Pivot chords, cadences (V7-I), II-V-I progressions.</li>
                </ul>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Applications: Classical (sonata development), Jazz (II-V-I), Pop/Rock (simple modulations).</p>
                <p class="text-gray-600 dark:text-gray-400">Visualization: Imagine a clock with C at 12 o'clock, clockwise for ascending fifths (G, D...), counterclockwise for descending (F, Bb...). Minor keys inside.</p>
            </div>
            <h2 class="text-center text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Interactive Visualization of the Circle of Fifths</h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-4">Click on a key to see its neighbors (ascending/descending fifth and relative minor).</p>
            <div id="canvas-holder" class="flex justify-center mb-6"></div>
            <h2 class="text-center text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Table of Progressions for Modulations</h2>
            <div class="overflow-x-auto mb-6">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-800">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">From</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">To</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Pivot Chord</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Example Progression</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200 dark:bg-gray-900 dark:divide-gray-700">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">C major</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">G major</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">D minor (II of C, V of G)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">C - Dm - G7 - C</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">A harmonic minor</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">E major</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">E major (V of A harm min)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">Am - Dm - E7 - Am</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">Phrygian dominant (E)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">A minor</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">A minor (IV of Phrygian dominant)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">E - F - Am - E</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">A harmonic minor</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">C augmented</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">C augmented (III of A harm min)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-900 dark:text-gray-100">Am - Caug - F - Am</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <div class="section-separator"></div>

        <!-- Section 4: Chord Progression Grid -->
        <section id="chord-grid" class="mb-12">
            <h1 class="section-title text-center text-gray-800 dark:text-gray-200">Chord Progression Grid</h1>
            <div class="controls flex justify-center gap-4 mt-4">
                <select id="chordMode" class="p-2 border rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100" aria-label="Select a mode for chords">
                    <option value="ionian">Ionian</option>
                    <option value="dorian">Dorian</option>
                    <option value="phrygian">Phrygian</option>
                    <option value="lydian">Lydian</option>
                    <option value="mixolydian">Mixolydian</option>
                    <option value="aeolian">Aeolian</option>
                    <option value="locrian">Locrian</option>
                    <option value="harmonic_minor">Harmonic Minor</option>
                    <option value="locrian_n6">Locrian ♮6</option>
                    <option value="ionian_s5">Ionian ♯5</option>
                    <option value="dorian_s4">Dorian ♯4</option>
                    <option value="phrygian_dominant">Phrygian Dominant</option>
                    <option value="lydian_s2">Lydian ♯2</option>
                    <option value="altered">Altered</option>
                </select>
            </div>
            <div class="chord-table mt-4">
                <table>
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>I</th>
                            <th>II</th>
                            <th>III</th>
                            <th>IV</th>
                            <th>V</th>
                            <th>VI</th>
                            <th>VII</th>
                        </tr>
                    </thead>
                    <tbody id="chordTableBody"></tbody>
                </table>
            </div>
        </section>

        <div class="section-separator"></div>

        <!-- Section 5: FAQ -->
        <section id="faq" class="mb-12">
            <div class="text-center mb-8">
                <h1 class="section-title text-gray-800 dark:text-gray-200 mb-4">Frequently Asked Questions</h1>
                <div class="flex justify-center items-center space-x-4 text-gray-600 dark:text-gray-400">
                    <span class="bg-gray-800/10 px-4 py-2 rounded-full text-sm font-medium">Section 4 of 4</span>
                </div>
            </div>
            <div class="card rounded-3xl p-6">
                <div class="faq-question">What are musical modes?</div>
                <div class="faq-answer">Musical modes are scales derived from the major scale, each starting on a different degree, offering unique sounds and emotions.</div>
                <div class="faq-question">How does the circle of fifths work?</div>
                <div class="faq-answer">The circle of fifths organizes keys by fifths, helping with key relationships, modulations, and chord progressions.</div>
            </div>
        </section>

        <div id="modeModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal()">&times;</span>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Complete mode data
        const intervalData = { labels: ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'] };
        const modesData = {
            diatonic: [
                { label: 'Ionian', data: [1, 1, 0.5, 1, 1, 1, 0.5], borderColor: 'rgba(75, 192, 192, 1)', tonality: 'C to C', notes: 'C - D - E - F - G - A - B - C', intervals: 'W-W-H-W-W-W-H', characteristics: 'Bright, joyful', chords: ['maj', 'min', 'min', 'maj', 'maj', 'min', 'dim'], examples: 'Happy Birthday', progression: 'I-IV-V-I', description: 'Standard major mode', defaultTonic: 'C' },
                { label: 'Dorian', data: [1, 0.5, 1, 1, 1, 0.5, 1], borderColor: 'rgba(54, 162, 235, 1)', tonality: 'D to D', notes: 'D - E - F - G - A - B - C - D', intervals: 'W-H-W-W-W-H-W', characteristics: 'Melancholic, jazz', chords: ['min', 'min', 'maj', 'maj', 'min', 'dim', 'maj'], examples: 'Scarborough Fair', progression: 'i-IV', description: 'Minor mode with major sixth', defaultTonic: 'D' },
                { label: 'Phrygian', data: [0.5, 1, 1, 1, 0.5, 1, 1], borderColor: 'rgba(255, 206, 86, 1)', tonality: 'E to E', notes: 'E - F - G - A - B - C - D - E', intervals: 'H-W-W-W-H-W-W', characteristics: 'Spanish, flamenco', chords: ['min', 'maj', 'maj', 'min', 'dim', 'maj', 'maj'], examples: 'Misirlou', progression: 'i-bII', description: 'Minor mode with minor second', defaultTonic: 'E' },
                { label: 'Lydian', data: [1, 1, 1, 0.5, 1, 1, 0.5], borderColor: 'rgba(153, 102, 255, 1)', tonality: 'F to F', notes: 'F - G - A - B - C - D - E - F', intervals: 'W-W-W-H-W-W-H', characteristics: 'Dreamy, film', chords: ['maj', 'maj', 'dim', 'min', 'maj', 'min', 'min'], examples: 'The Simpsons Theme', progression: 'I-II', description: 'Major mode with augmented fourth', defaultTonic: 'F' },
                { label: 'Mixolydian', data: [1, 1, 0.5, 1, 1, 0.5, 1], borderColor: 'rgba(255, 159, 64, 1)', tonality: 'G to G', notes: 'G - A - B - C - D - E - F - G', intervals: 'W-W-H-W-W-H-W', characteristics: 'Blues, rock', chords: ['maj', 'min', 'dim', 'maj', 'min', 'min', 'maj'], examples: 'Old Joe Clark', progression: 'I-bVII-IV', description: 'Major mode with minor seventh', defaultTonic: 'G' },
                { label: 'Aeolian', data: [1, 0.5, 1, 1, 0.5, 1, 1], borderColor: 'rgba(255, 99, 132, 1)', tonality: 'A to A', notes: 'A - B - C - D - E - F - G - A', intervals: 'W-H-W-W-H-W-W', characteristics: 'Sad, natural minor', chords: ['min', 'dim', 'maj', 'min', 'min', 'maj', 'maj'], examples: 'Losing My Religion', progression: 'i-VI-III-VII', description: 'Natural minor mode', defaultTonic: 'A' },
                { label: 'Locrian', data: [0.5, 1, 1, 0.5, 1, 1, 1], borderColor: 'rgba(201, 203, 207, 1)', tonality: 'B to B', notes: 'B - C - D - E - F - G - A - B', intervals: 'H-W-W-H-W-W-W', characteristics: 'Unstable, tense', chords: ['dim', 'maj', 'min', 'min', 'maj', 'maj', 'min'], examples: 'Rarely used alone', progression: 'i-bII', description: 'Diminished mode, very unstable', defaultTonic: 'B' }
            ],
            harmonic: [
                { label: 'Harmonic Minor', data: [1, 0.5, 1, 1, 0.5, 1.5, 0.5], borderColor: 'rgba(255, 99, 132, 1)', tonality: 'A to A', notes: 'A - B - C - D - E - F - G# - A', intervals: 'W-H-W-W-H-A2-H', characteristics: 'Dramatic, oriental', chords: ['min', 'dim', 'aug', 'min', 'maj', 'maj', 'dim'], examples: 'Enter Sandman intro', progression: 'i-V', description: 'Minor with major seventh', defaultTonic: 'A' },
                { label: 'Locrian ♮6', data: [0.5, 1, 1, 0.5, 1.5, 0.5, 1], borderColor: 'rgba(75, 192, 192, 1)', tonality: 'B to B', notes: 'B - C - D - E - F - G# - A - B', intervals: 'H-W-W-H-A2-H-W', characteristics: 'Jazz, dark', chords: ['dim', 'aug', 'min', 'maj', 'maj', 'dim', 'min'], examples: 'Jazz fusion', progression: 'i-bIII', description: 'Locrian with natural sixth', defaultTonic: 'B' },
                { label: 'Ionian ♯5', data: [1, 1, 0.5, 1.5, 0.5, 1, 0.5], borderColor: 'rgba(54, 162, 235, 1)', tonality: 'C to C', notes: 'C - D - E - F# - G# - A - B - C', intervals: 'W-W-H-A2-H-W-H', characteristics: 'Augmented, mystical', chords: ['aug', 'min', 'maj', 'maj', 'dim', 'min', 'dim'], examples: 'Modern classical', progression: 'I-III', description: 'Ionian with augmented fifth', defaultTonic: 'C' },
                { label: 'Dorian ♯4', data: [1, 0.5, 1.5, 0.5, 1, 0.5, 1], borderColor: 'rgba(255, 206, 86, 1)', tonality: 'D to D', notes: 'D - E - F# - G# - A - B - C - D', intervals: 'W-H-A2-H-W-H-W', characteristics: 'Jazz, experimental', chords: ['min', 'maj', 'maj', 'dim', 'min', 'dim', 'aug'], examples: 'Jazz', progression: 'i-IV', description: 'Dorian with augmented fourth', defaultTonic: 'D' },
                { label: 'Phrygian Dominant', data: [0.5, 1.5, 0.5, 1, 0.5, 1, 1], borderColor: 'rgba(153, 102, 255, 1)', tonality: 'E to E', notes: 'E - F - G# - A - B - C - D - E', intervals: 'H-A2-H-W-H-W-W', characteristics: 'Flamenco, metal', chords: ['maj', 'maj', 'dim', 'min', 'dim', 'aug', 'min'], examples: 'Miserlou variation', progression: 'I-bII', description: 'Phrygian with major third', defaultTonic: 'E' },
                { label: 'Lydian ♯2', data: [1.5, 0.5, 1, 0.5, 1, 1, 0.5], borderColor: 'rgba(255, 159, 64, 1)', tonality: 'F# to F#', notes: 'F# - G# - A# - B - C# - D# - E - F#', intervals: 'A2-H-W-H-W-W-H', characteristics: 'Exotic, bright', chords: ['maj', 'dim', 'min', 'dim', 'aug', 'min', 'maj'], examples: 'World music', progression: 'I-II', description: 'Lydian with augmented second', defaultTonic: 'F#' },
                { label: 'Altered', data: [0.5, 1, 0.5, 1, 1, 1, 0.5], borderColor: 'rgba(201, 203, 207, 1)', tonality: 'G# to G#', notes: 'G# - A - B - C - D - E - F - G#', intervals: 'H-W-H-W-W-W-H', characteristics: 'Jazz, tense', chords: ['dim', 'min', 'dim', 'aug', 'min', 'maj', 'maj'], examples: 'Jazz altered dominant', progression: 'i-VII', description: 'Super Locrian, altered scale', defaultTonic: 'G#' }
            ]
        };

        // Common constants
        const chromaticSharps = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const chromaticFlats = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
        const noteMap = {
            'C': 0, 'B#': 0,
            'C#': 1, 'Db': 1,
            'D': 2,
            'D#': 3, 'Eb': 3,
            'E': 4, 'Fb': 4,
            'F': 5, 'E#': 5,
            'F#': 6, 'Gb': 6,
            'G': 7,
            'G#': 8, 'Ab': 8,
            'A': 9,
            'A#': 10, 'Bb': 10,
            'B': 11, 'Cb': 11
        };

        const majorKeys = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'Db', 'Ab', 'Eb', 'Bb', 'F'];
        const minorKeys = ['Am', 'Em', 'Bm', 'F#m', 'C#m', 'G#m', 'D#m', 'Bbm', 'Fm', 'Cm', 'Gm', 'Dm'];

        // Create chordModes from modesData
        const chordModes = {};
        modesData.diatonic.forEach(mode => {
            const key = mode.label.toLowerCase().replace('é', 'e');
            chordModes[key] = { intervals: mode.data.map(v => v * 2), chords: mode.chords };
        });
        modesData.harmonic.forEach(mode => {
            const key = mode.label.toLowerCase().replace(/ /g, '_').replace('é', 'e').replace('♮', 'n').replace('♯', 's');
            chordModes[key] = { intervals: mode.data.map(v => v * 2), chords: mode.chords };
        });

        const cache = new Map();

        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('themeToggle').textContent = isDark ? 'Light Mode' : 'Dark Mode';
        }

        // Load theme on startup
        if (localStorage.getItem('theme') === 'dark') {
            toggleTheme();
        }

        function transposeNote(note, semitones, preferFlat = false) {
            let root = note.replace('m', ''); // Remove 'm' for minor keys
            let index = noteMap[root];
            if (index === undefined) return note;
            const newIndex = (index + semitones + 12) % 12;
            const notes = preferFlat ? chromaticFlats : chromaticSharps;
            return notes[newIndex] + (note.includes('m') ? 'm' : '');
        }

        function generateScale(tonic, modeIntervals) {
            const cacheKey = `${tonic}-${modeIntervals.join('-')}`;
            if (cache.has(cacheKey)) return cache.get(cacheKey);

            const preferFlat = tonic.includes('b') || ['F', 'Bb', 'Eb', 'Ab', 'Db', 'Gm', 'Cm', 'Fm', 'Bbm', 'Ebm', 'Dm'].includes(tonic.replace('m', ''));

            let scale = [tonic];
            let currentNote = tonic.replace('m', ''); // Use root without 'm'
            modeIntervals.forEach(interval => {
                currentNote = transposeNote(currentNote, interval, preferFlat);
                scale.push(currentNote + (tonic.includes('m') ? 'm' : ''));
            });
            cache.set(cacheKey, scale);
            return scale;
        }

        function generateChordsForKey(tonic, mode) {
            const scale = generateScale(tonic, mode.intervals);
            return mode.chords.map((chordType, i) => {
                let root = scale[i].replace('m', ''); // Extract root
                return root + (chordType === 'maj' ? '' : chordType); // Add quality except for 'maj'
            });
        }

        function updateChordGrid() {
            const modeSelect = document.getElementById('chordMode');
            let modeKey = modeSelect.value;
            let mode = chordModes[modeKey] || chordModes['ionian']; // Default to Ionian if mode not found
            const tbody = document.getElementById('chordTableBody');
            tbody.innerHTML = '';

            const allKeys = [...majorKeys, ...minorKeys];
            allKeys.forEach(key => {
                const chords = generateChordsForKey(key, mode);
                const row = document.createElement('tr');
                row.innerHTML = `<td>${key}</td>${chords.map(chord => `<td>${chord}</td>`).join('')}`;
                tbody.appendChild(row);
            });
        }

        let chart;
        function initializeChart() {
            const ctx = document.getElementById('modesChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: intervalData.labels, datasets: [] },
                options: {
                    responsive: true,
                    scales: { 
                        y: { 
                            min: 0.5, 
                            max: 1.5, 
                            ticks: { 
                                stepSize: 0.5, 
                                callback: v => v === 0.5 ? 'H' : v === 1 ? 'W' : v === 1.5 ? 'A2' : '' 
                            } 
                        } 
                    },
                    plugins: { 
                        legend: { 
                            display: true,
                            onClick: (e, legendItem) => {
                                const mode = legendItem.text;
                                selectMode({ target: { value: mode } }, mode.includes('Harmonic') ? 'harmonic' : 'diatonic');
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    let value = context.parsed.y;
                                    let interval = value === 0.5 ? 'H' : value === 1 ? 'W' : 'A2';
                                    let modeKey = label.toLowerCase().replace(/ /g, '_').replace('♮', 'n').replace('♯', 's');
                                    let mode = chordModes[modeKey];
                                    if (mode) {
                                        let degreeIndex = context.dataIndex;
                                        let chordType = mode.chords[degreeIndex];
                                        return `${label} - Interval: ${interval}, Chord: ${chordType}`;
                                    }
                                    return `${label} - Interval: ${interval}`;
                                }
                            }
                        }
                    },
                    elements: { line: { tension: 0 } }
                }
            });
        }

        let visibleModes = new Set();
        let highlightedMode = null;
        let currentComparison = '';

        const allDatasets = [...modesData.diatonic, ...modesData.harmonic].map(mode => ({
            label: mode.label,
            data: mode.data,
            borderColor: mode.borderColor,
            fill: false
        }));

        function selectMode(event, type) {
            const mode = event.target.value || event.target.innerText;
            if (type === 'diatonic') {
                document.getElementById('harmonicMode').value = '';
                currentComparison = mode;
            } else if (type === 'harmonic') {
                document.getElementById('diatonicMode').value = '';
                currentComparison = mode;
            }
            visibleModes.clear();
            if (mode) visibleModes.add(mode);
            updateChart();
            updateIntervalGrid();
            updateModeDetails(mode);
            const modeKey = mode.toLowerCase().replace(/ /g, '_').replace('♮', 'n').replace('♯', 's');
            if (chordModes[modeKey]) {
                document.getElementById('chordMode').value = modeKey;
                updateChordGrid();
            }
        }

        function resetChart() {
            document.getElementById('diatonicMode').value = '';
            document.getElementById('harmonicMode').value = '';
            currentComparison = '';
            visibleModes = new Set();
            updateChart();
            updateIntervalGrid();
            document.getElementById('chordMode').value = 'ionian';
            updateChordGrid();
            updateModeDetails(null);
        }

        function updateChart() {
            let datasets = allDatasets.filter(ds => visibleModes.has(ds.label));
            chart.data.datasets = datasets;
            chart.update();
        }

        function updateIntervalGrid() {
            const tbody = document.getElementById('intervalTableBody');
            tbody.innerHTML = '';
            allDatasets.forEach(ds => {
                if (visibleModes.has(ds.label)) {
                    const row = document.createElement('tr');
                    const intervals = ds.data.map(v => v === 0.5 ? 'H' : v === 1 ? 'W' : 'A2');
                    row.innerHTML = `<td>${ds.label}</td>${intervals.map(i => `<td>${i}</td>`).join('')}`;
                    tbody.appendChild(row);
                }
            });
        }

        function updateModeDetails(mode) {
            const detailsDiv = document.getElementById('modeDetails');
            if (mode) {
                const selectedMode = [...modesData.diatonic, ...modesData.harmonic].find(m => m.label === mode);
                if (selectedMode) {
                    document.getElementById('modeDetailTitle').textContent = selectedMode.label;
                    document.getElementById('modeDetailTonality').textContent = selectedMode.tonality;
                    document.getElementById('modeDetailNotes').textContent = selectedMode.notes;
                    document.getElementById('modeDetailIntervals').textContent = selectedMode.intervals;
                    document.getElementById('modeDetailCharacteristics').textContent = selectedMode.characteristics;
                    document.getElementById('modeDetailExamples').textContent = selectedMode.examples;
                    document.getElementById('modeDetailProgression').textContent = selectedMode.progression;
                    document.getElementById('modeDetailDescription').textContent = selectedMode.description;
                    document.getElementById('modeDetailDefaultTonic').textContent = selectedMode.defaultTonic;
                    detailsDiv.style.display = 'block';
                }
            } else {
                detailsDiv.style.display = 'none';
            }
        }

        // p5.js for circle of fifths
        let selectedKey = null;

        function setup() {
            let canvas = createCanvas(600, 600);
            canvas.parent('canvas-holder');
            textAlign(CENTER, CENTER);
            textSize(16);
        }

        function draw() {
            const isDark = document.body.classList.contains('dark');
            background(isDark ? 55 : 255);
            let centerX = width / 2, centerY = height / 2, radius = 180;
            noFill();
            stroke(isDark ? 200 : 0);
            strokeWeight(2);
            ellipse(centerX, centerY, radius * 2);

            const majorOffset = 20;
            const minorOffset = -30;

            for (let i = 0; i < 12; i++) {
                let angle = TWO_PI / 12 * i - HALF_PI;
                let xMaj = centerX + cos(angle) * (radius + majorOffset);
                let yMaj = centerY + sin(angle) * (radius + majorOffset);
                fill(selectedKey === majorKeys[i] ? color(255, 0, 0) : isDark ? 255 : 0);
                noStroke();
                text(majorKeys[i], xMaj, yMaj);

                let xMin = centerX + cos(angle) * (radius + minorOffset);
                let yMin = centerY + sin(angle) * (radius + minorOffset);
                fill(selectedKey === minorKeys[i] ? color(0, 0, 255) : isDark ? 200 : 100);
                text(minorKeys[i], xMin, yMin);
            }

            if (selectedKey) {
                let index = majorKeys.indexOf(selectedKey);
                if (index === -1) index = minorKeys.indexOf(selectedKey);
                let prevKey = index > 0 ? majorKeys[index - 1] : majorKeys[11];
                let nextKey = index < 11 ? majorKeys[index + 1] : majorKeys[0];
                let relMinor = minorKeys[index];
                textSize(18);
                textStyle(BOLD);
                fill(isDark ? 255 : 0);
                noStroke();
                text(`Key: ${selectedKey}`, centerX, centerY + radius + 50);
                textStyle(NORMAL);
                text(`Neighbors: ${prevKey}, ${nextKey}, ${relMinor} (rel. minor)`, centerX, centerY + radius + 70);
                highlightChordRow(selectedKey);
            }
        }

        function mousePressed() {
            let centerX = width / 2;
            let centerY = height / 2;
            let radius = 180;
            let majorOffset = 20;
            let minorOffset = -30;
            let d = dist(mouseX, mouseY, centerX, centerY);

            if (d > radius + majorOffset - 20 && d < radius + majorOffset + 20) {
                let angle = atan2(mouseY - centerY, mouseX - centerX) + HALF_PI;
                if (angle < 0) angle += TWO_PI;
                let index = floor((angle / TWO_PI) * 12);
                selectedKey = majorKeys[index];
            } else if (d > radius + minorOffset - 20 && d < radius + minorOffset + 20) {
                let angle = atan2(mouseY - centerY, mouseX - centerX) + HALF_PI;
                if (angle < 0) angle += TWO_PI;
                let index = floor((angle / TWO_PI) * 12);
                selectedKey = minorKeys[index];
            } else {
                selectedKey = null;
            }
        }

        function highlightChordRow(key) {
            const rows = document.querySelectorAll('#chordTableBody tr');
            rows.forEach(row => {
                row.classList.remove('highlight');
                if (row.cells[0].textContent === key) {
                    row.classList.add('highlight');
                }
            });
        }

        function closeModal() {
            document.getElementById('modeModal').style.display = 'none';
        }

        // Events
        document.getElementById('diatonicMode').addEventListener('change', (e) => selectMode(e, 'diatonic'));
        document.getElementById('harmonicMode').addEventListener('change', (e) => selectMode(e, 'harmonic'));
        document.getElementById('chordMode').addEventListener('change', updateChordGrid);

        // Initialization
        window.onload = () => {
            initializeChart();
            document.getElementById('chordMode').value = 'ionian';
            updateChordGrid();
            updateIntervalGrid();

            // Add FAQ toggle functionality
            const faqQuestions = document.querySelectorAll('.faq-question');
            faqQuestions.forEach(question => {
                question.addEventListener('click', () => {
                    const answer = question.nextElementSibling;
                    answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
                });
            });
        };
    </script>
</body>
</html>